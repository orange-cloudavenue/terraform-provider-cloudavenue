---
page_title: "cloudavenue_elb_virtual_service Resource - cloudavenue"
subcategory: "ELB (EdgeGateway Load Balancer)"
description: |-
  Provides a resource to manage ELB Virtual services for particular Gateway. A virtual service advertises an IP address and ports to the external world and listens for client traffic. When a virtual service receives traffic, it directs it to members in ELB Pool.
---

# cloudavenue_elb_virtual_service (Resource)

 ~> **SUBSCRIBE REQUIRED** This resource require to subscribe to the Load Balancer service. Please open a ticket to the support team to enable the service.

Provides a resource to manage ELB Virtual services for particular Gateway. A virtual service advertises an IP address and ports to the external world and listens for client traffic. When a virtual service receives traffic, it directs it to members in ELB Pool.

## Example Usage

```terraform
resource "cloudavenue_elb_virtual_service" "example" {
  name    = "example"
  enabled = true

  virtual_ip = "192.168.0.1"

  pool_id         = cloudavenue_elb_pool.example.id
  edge_gateway_id = cloudavenue_edgegateway.example.id

  service_type = "HTTP"
  service_ports = [
    {
      start = 80
    }
  ]
}
```
 -> More examples can be found at the [Advanced Usage](#advanced-usage) section.


<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) The name of the ELB Virtual Service.
- `service_ports` (Attributes List) The service port of the ELB Virtual Service. The service port is the port on which the virtual service listens for client traffic. (see [below for nested schema](#nestedatt--service_ports))
- `service_type` (String) The type of the service. The different modes that the ELB supports for handling TCP traffic and various parameters that can be tuned for optimization of the TCP traffic are also detailed here. Value must be one of : `HTTP`, `HTTPS`, `L4_TCP`, `L4_UDP`, `L4_TLS`.
- `virtual_ip` (String) The virtual IP address of the ELB Virtual Service. 

 -> The `virtual_ip` accept a private IP in your network range or a public IP (Warning: the public IP must be reserved and not used by any other service). The value must be a valid IPV4 address (`192.168.0.1`).

### Optional

- `certificate_id` (String) The ID of the certificate. The certificate must be uploaded to your certificate library before it can be used. The certificate MUSTN'T be expired. If the value of [`<.service_type`](#<.service_type) attribute is one of `L4_TLS` or `HTTPS` this attribute is **REQUIRED**. If the value of [`<.service_type`](#<.service_type) attribute is one of `HTTP`, `L4_TCP` or `L4_UDP` this attribute is **NULL**. This value must start with `urn:vcloud:certificateLibraryItem:`.
- `description` (String) The description of the ELB Virtual Service.
- `edge_gateway_id` (String) (ForceNew) The ID of the edge gateway on which the ELB Virtual Service is to be created. Ensure that one and only one attribute from this collection is set : `edge_gateway_name`, `edge_gateway_id`.
- `edge_gateway_name` (String) (ForceNew) The name of the edge gateway on which the ELB Virtual Service is to be created. Ensure that one and only one attribute from this collection is set : `edge_gateway_name`, `edge_gateway_id`.
- `enabled` (Boolean) Defines if the ELB Virtual Service is enabled. Value defaults to `true`.
- `pool_id` (String) The ID of the ELB Server Pool associated. Ensure that one and only one attribute from this collection is set : `pool_name`, `pool_id`.
- `pool_name` (String) The name of the ELB Server Pool associated. Ensure that one and only one attribute from this collection is set : `pool_name`, `pool_id`.
- `service_engine_group_name` (String) The name of the service Engine Group (Take the first one if not specified).

### Read-Only

- `id` (String) The ID of the ELB virtual service.

<a id="nestedatt--service_ports"></a>
### Nested Schema for `service_ports`

Required:

- `start` (Number) The start port of the service port range or exact port number if `end` is not set. Value must be between 1 and 65535.

Optional:

- `end` (Number) The end port of the service port range. If not specified, only the `start` value is used. Value must be between 1 and 65535.

## Advanced Usage

### Expose TLS service

Use the resource `cloudavenue_org_certificate_library` to reference the certificate used for the HTTPS service.
This example exposes a HTTPS service on the virtual IP `192.168.0.1` on port `443`.

```hcl
resource "cloudavenue_elb_virtual_service" "example_https" {
  name = "example"
  enabled = true
  
  edge_gateway_id = cloudavenue_edgegateway.example.id
  pool_id = cloudavenue_elb_pool.example.id
  certificate_id = cloudavenue_org_certificate_library.example.id

  virtual_ip = "192.168.0.1"

  service_type = "HTTPS" // Use HTTPS or L4_TLS
  service_ports = [
    {
      start = 443
    }
  ]
}
```

### Expose L4 service

This example exposes a L4 TCP service on the virtual IP `192.168.0.1` on port `443`.

```hcl
resource "cloudavenue_elb_virtual_service" "example_https" {
  name = "example"
  enabled = true

  edge_gateway_id = cloudavenue_edgegateway.example.id
  pool_id = cloudavenue_elb_pool.example.id

  virtual_ip = "192.168.0.1"

  service_type = "L4_TCP" // Use L4_TCP or L4_UDP
  service_ports = [
    {
      start = 443
    }
  ]
}
```

### Expose service with public IP

The ELB virtual service require a **dedicated public IP** to expose the service.
If another resource use the same public IP, the ELB virtual service will fail to create.

```hcl
resource "cloudavenue_elb_virtual_service" "example_https" {
  name = "example"
  enabled = true

  edge_gateway_id = cloudavenue_edgegateway.example.id
  pool_id = cloudavenue_elb_pool.example.id
  virtual_ip = cloudavenue_public_ip.example.public_ip

  [...]
}
```

## Import

Import is supported using the following syntax:
```shell
terraform import cloudavenue_elb_virtual_service.example edgeGatewayNameOrID.virtualServiceIDOrName
```