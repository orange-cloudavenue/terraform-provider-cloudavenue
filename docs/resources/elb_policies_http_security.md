---
page_title: "cloudavenue_elb_policies_http_security Resource - cloudavenue"
subcategory: "ELB (EdgeGateway Load Balancer)"
description: |-
  The cloudavenue_elb_policies_http_security resource allows you to manage HTTP security policies. HTTP security rules modify requests before they are either forwarded to the application, used as a basis for content switching, or discarded.
---

# cloudavenue_elb_policies_http_security (Resource)

The `cloudavenue_elb_policies_http_security` resource allows you to manage HTTP security policies. HTTP security rules modify requests before they are either forwarded to the application, used as a basis for content switching, or discarded.

## Example Usage

```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // Define the action to take when the criteria is met
      actions = {
        redirect_to_https = 443
      }
    } // End policy 1
  ]   // End policies
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `policies` (Attributes List) HTTP security policies. (see [below for nested schema](#nestedatt--policies))
- `virtual_service_id` (String) <i style="color:red;font-weight: bold">(ForceNew)</i> The ID of the virtual service to which the policies http security belongs. The value must respect the following rule : must be a valid URN. This value must start with `urn:vcloud:loadBalancerVirtualService:`.

### Read-Only

- `id` (String) The ID of the policies http security.

<a id="nestedatt--policies"></a>
### Nested Schema for `policies`

Required:

- `actions` (Attributes) Actions to perform when the rule matches. (see [below for nested schema](#nestedatt--policies--actions))
- `criteria` (Attributes) Match criteria for the HTTP security. The criteria is used to match the request and determine if the action should be applied. (see [below for nested schema](#nestedatt--policies--criteria))
- `name` (String) Policy name, it must be unique within the virtual service's HTTP security policies.

Optional:

- `active` (Boolean) Whether the policy is enable or not. Value defaults to `true`.
- `logging` (Boolean) Whether to enable logging with headers on rule match or not. Value defaults to `false`.

<a id="nestedatt--policies--actions"></a>
### Nested Schema for `policies.actions`

Optional:

- `connection` (String) Connection action to perform. Value must be one of : `ALLOW`, `CLOSE`. If the [`<.redirect_to_https`](#<.redirect_to_https) attribute is set this attribute is **NULL**. If the [`<.send_response`](#<.send_response) attribute is set this attribute is **NULL**. If the [`<.rate_limit`](#<.rate_limit) attribute is set this attribute is **NULL**.
- `rate_limit` (Attributes) The rate_limit allows you to specify an action to take when the rate limit is reached. A rate limit defines the maximum number of requests permitted within a specific time frame. If the [`<.redirect_to_https`](#<.redirect_to_https) attribute is set this attribute is **NULL**. If the [`<.connection`](#<.connection) attribute is set this attribute is **NULL**. If the [`<.send_response`](#<.send_response) attribute is set this attribute is **NULL**. (see [below for nested schema](#nestedatt--policies--actions--rate_limit))
- `redirect_to_https` (Number) A port number, when set, configures the rule to redirect matching HTTP requests to HTTPS on the specified port. Value must be between 1 and 65535. If the [`<.connection`](#<.connection) attribute is set this attribute is **NULL**. If the [`<.send_response`](#<.send_response) attribute is set this attribute is **NULL**. If the [`<.rate_limit`](#<.rate_limit) attribute is set this attribute is **NULL**.
- `send_response` (Attributes) Send a customized response. If the [`<.redirect_to_https`](#<.redirect_to_https) attribute is set this attribute is **NULL**. If the [`<.connection`](#<.connection) attribute is set this attribute is **NULL**. If the [`<.rate_limit`](#<.rate_limit) attribute is set this attribute is **NULL**. (see [below for nested schema](#nestedatt--policies--actions--send_response))

<a id="nestedatt--policies--actions--rate_limit"></a>
### Nested Schema for `policies.actions.rate_limit`

Optional:

- `close_connection` (Boolean) Close connection when the rate limit is reached. If the [`<.redirect`](#<.redirect) attribute is set this attribute is **NULL**. If the [`<.local_response`](#<.local_response) attribute is set this attribute is **NULL**.
- `count` (Number) Number of requests. Value defaults to `100`. Value must be between 1 and 1000.
- `local_response` (Attributes) Local response action can be used to send a customized response when the rate limit is reached. If the [`<.redirect`](#<.redirect) attribute is set this attribute is **NULL**. If the [`<.close_connection`](#<.close_connection) attribute is set this attribute is **NULL**. (see [below for nested schema](#nestedatt--policies--actions--rate_limit--local_response))
- `period` (Number) Period in seconds. Value defaults to `60`. Value must be between 1 and 1000000000.
- `redirect` (Attributes) Redirects the request to different location when the rate limit is reached. If the [`<.local_response`](#<.local_response) attribute is set this attribute is **NULL**. If the [`<.close_connection`](#<.close_connection) attribute is set this attribute is **NULL**. (see [below for nested schema](#nestedatt--policies--actions--rate_limit--redirect))

<a id="nestedatt--policies--actions--rate_limit--local_response"></a>
### Nested Schema for `policies.actions.rate_limit.local_response`

Required:

- `content` (String) Content of the response must be a base64 encoded string. Example: result of `echo -n 'Hello World' | base64` will be `SGVsbG8gV29ybGQ=`. String length must be at most 10240. The value must respect the following rule : must be a valid base64 string.
- `content_type` (String) Mime type of content. Value must be one of : `application/json`, `text/plain`, `text/html`.
- `status_code` (Number) HTTP status code to return. Value must be one of : `200`, `204`, `403`, `404`, `429`, `501`.


<a id="nestedatt--policies--actions--rate_limit--redirect"></a>
### Nested Schema for `policies.actions.rate_limit.redirect`

Required:

- `port` (Number) Port to which redirect the request. Value must be between 1 and 65535.
- `protocol` (String) HTTP protocol. Value must be one of : `HTTP`, `HTTPS`.

Optional:

- `host` (String) Host to which redirect the request. Default is the original host.
- `keep_query` (Boolean) Keep or drop the query of the incoming request URI in the redirected URI. Value defaults to `true`.
- `path` (String) Path to which redirect the request. Default is the original path.
- `status_code` (Number) Redirect status code. Value defaults to `302`. Value must be one of : `301`, `302`, `307`.



<a id="nestedatt--policies--actions--send_response"></a>
### Nested Schema for `policies.actions.send_response`

Required:

- `content` (String) Content of the response. String length must be at most 10240. The value must respect the following rule : must be a valid base64 string.
- `content_type` (String) Mime type of content. Value must be one of : `application/json`, `text/plain`, `text/html`.

Optional:

- `status_code` (Number) HTTP status code to return. Value defaults to `200`. Value must be one of : `200`, `204`, `403`, `404`, `429`, `501`.



<a id="nestedatt--policies--criteria"></a>
### Nested Schema for `policies.criteria`

Optional:

- `client_ip` (Attributes) Match the rule based on client IP address rules. (see [below for nested schema](#nestedatt--policies--criteria--client_ip))
- `cookie` (Attributes) Match the rule based on cookie rules. (see [below for nested schema](#nestedatt--policies--criteria--cookie))
- `http_methods` (Attributes) Match the rule based on HTTP method rules. (see [below for nested schema](#nestedatt--policies--criteria--http_methods))
- `path` (Attributes) Match the rule based on path rules. (see [below for nested schema](#nestedatt--policies--criteria--path))
- `protocol` (String) Protocol to match. Only HTTP application layer protocol (OSI 7) are supported. Value must be one of : `HTTP`, `HTTPS`.
- `query` (Set of String) Text contained in the query string.
- `request_headers` (Attributes Set) Match the rule based on request headers rules. (see [below for nested schema](#nestedatt--policies--criteria--request_headers))
- `service_ports` (Attributes) Match the rule based on service port rules. (see [below for nested schema](#nestedatt--policies--criteria--service_ports))

<a id="nestedatt--policies--criteria--client_ip"></a>
### Nested Schema for `policies.criteria.client_ip`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `IS_IN`, `IS_NOT_IN`.
- `ip_addresses` (Set of String) IP addresses to match. Element value must satisfy all validations: The value must be at least one of the following :
a valid IPV4 address (Ex: 192.168.0.1), a valid IPV4 address with CIDR (Ex: 192.168.0.1/24), a valid IPV4 address range (Ex: 192.168.0.1-192.168.0.100).


<a id="nestedatt--policies--criteria--cookie"></a>
### Nested Schema for `policies.criteria.cookie`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `BEGINS_WITH`, `DOES_NOT_BEGIN_WITH`, `CONTAINS`, `DOES_NOT_CONTAIN`, `ENDS_WITH`, `DOES_NOT_END_WITH`, `EQUALS`, `DOES_NOT_EQUAL`, `EXISTS`, `DOES_NOT_EXIST`.
- `name` (String) Name of the cookie to match.

Optional:

- `value` (String) Value of the cookie to match. If the value of [`<.criteria`](#<.criteria) attribute is one of `EXISTS` or `DOES_NOT_EXIST` this attribute is **NULL**. If the value of [`<.criteria`](#<.criteria) attribute is one of `BEGINS_WITH`, `DOES_NOT_BEGIN_WITH`, `CONTAINS`, `DOES_NOT_CONTAIN`, `ENDS_WITH`, `DOES_NOT_END_WITH`, `EQUALS` or `DOES_NOT_EQUAL` this attribute is **REQUIRED**. String length must be at most 10240.


<a id="nestedatt--policies--criteria--http_methods"></a>
### Nested Schema for `policies.criteria.http_methods`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `IS_IN`, `IS_NOT_IN`.
- `methods` (Set of String) Methods to match. Element value must satisfy all validations: value must be one of: ["GET" "POST" "PUT" "DELETE" "PATCH" "OPTIONS" "TRACE" "CONNECT" "PROPFIND" "PROPPATCH" "MKCOL" "COPY" "MOVE" "LOCK" "UNLOCK"].


<a id="nestedatt--policies--criteria--path"></a>
### Nested Schema for `policies.criteria.path`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `BEGINS_WITH`, `DOES_NOT_BEGIN_WITH`, `CONTAINS`, `DOES_NOT_CONTAIN`, `ENDS_WITH`, `DOES_NOT_END_WITH`, `EQUALS`, `DOES_NOT_EQUAL`, `REGEX_MATCH`, `REGEX_DOES_NOT_MATCH`.
- `paths` (Set of String) A set of paths to match given criteria.


<a id="nestedatt--policies--criteria--request_headers"></a>
### Nested Schema for `policies.criteria.request_headers`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `BEGINS_WITH`, `DOES_NOT_BEGIN_WITH`, `CONTAINS`, `DOES_NOT_CONTAIN`, `ENDS_WITH`, `DOES_NOT_END_WITH`, `EQUALS`, `DOES_NOT_EQUAL`, `EXISTS`, `DOES_NOT_EXIST`.
- `name` (String) Name of the HTTP header whose value is to be matched.

Optional:

- `values` (Set of String) Values of the HTTP header to match.


<a id="nestedatt--policies--criteria--service_ports"></a>
### Nested Schema for `policies.criteria.service_ports`

Required:

- `criteria` (String) Criteria to match. Value must be one of : `IS_IN`, `IS_NOT_IN`.
- `ports` (Set of Number) A port list allows you to define which service ports (e.g.: [80, 443] ) the HTTP security policy should match. Element value must satisfy all validations: value must be between 1 and 65535.

## Advanced usages

### With action connection

This example shows how to create a HTTP security policy with an action connection.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action connection can be "ALLOW" or "CLOSE"
      // Only one action can be set at a time
      actions = {
        connection = "ALLOW"
      }
    } // End policy 1
  ]   // End policies
}
```

### With action redirect to https
This example shows how to create a HTTP security policy with an action redirect.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action redirect_to_https must be a port number
      // This action redirects the request to HTTPS on the specified port.
      // Only one action can be set at a time
      actions = {
        redirect_to_https = 443
      }
    } // End policy 1
  ]   // End policies
}
```

### With action send response
This example shows how to create a HTTP security policy with an action send response.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action send_response
      // The send_response action can be used to send a custom response
      // Only one action can be set at a time
      actions = {
        send_response = {
          status_code  = 403
          content      = base64("Access Denied")
          content_type = "text/plain"
        }
      }
    } // End policy 1
  ]   // End policies
}
```

### With action rate limit and close
This example shows how to create a HTTP security policy with an action rate limit and close.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action rate_limit can be set to limit the number of requests
      // The action close_connection can be set to close the connection when the rate limit is reached.
      // Only one action can be set at a time
      actions = {
        rate_limit = {
          count            = 1000
          period           = 60
          close_connection = true
        }
      }
    } // End policy 1
  ]   // End policies
}
```

### With action rate limit and redirect
This example shows how to create a HTTP security policy with an action rate limit and redirect.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action rate_limit can be set to limit the number of requests.
      // The action redirect can be set to redirect the request on port 8443 when the rate limit is reached.
      // Only one action can be set at a time
      actions = {
        rate_limit = {
          count  = 1000
          period = 60
          redirect = {
            port     = 8443
            protocol = "HTTPS"
          }
        }
      }
    } // End policy 1
  ]   // End policies
}
```

### With action rate limit and local response
This example shows how to create a HTTP security policy with an action rate limit and local response.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // This example checks if the request is using HTTP on port 80.
        protocol = "HTTP"
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80"]
        }
      }

      // The action rate_limit can be set to limit the number of requests
      // The action local_response can be set to return a custom response when the rate limit is reached.
      // Only one action can be set at a time
      actions = {
        rate_limit = {
          count  = 1000
          period = 60
          local_response = {
            status_code  = 429 //  https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/429
            content      = base64("Too Many Requests")
            content_type = "text/plain"
          }
        }
      }
    } // End policy 1
  ]   // End policies
}
```

### With multiple criterias
This example shows how to create a HTTP security policy with multiple criterias.
```terraform
resource "cloudavenue_elb_policies_http_security" "example" {
  virtual_service_id = cloudavenue_elb_virtual_service.example.id
  policies = [
    # Policy 1
    {
      name = "example"

      # Define the criteria for the policy
      criteria = {
        // Client IP criteria
        // This criteria checks if the client IP address is in the specified list or range
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS"
        // The ip_addresses can be a single IP, a CIDR range, or a range of IPs
        client_ip = {
          criteria = "IS_IN"
          ip_addresses = [
            "12.13.14.15",
            "12.13.14.0/24",
            "12.13.14.1-12.13.14.15"
          ]
        }
        // Cookie criteria
        // This criteria checks if the specified cookie name and value match the criteria
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS"
        // The name and value are the cookie name and value to check
        cookie = {
          criteria = "BEGINS_WITH"
          name     = "example"
          value    = "example"
        }
        // HTTP methods criteria
        // This criteria checks if the HTTP method is in the specified list
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS"
        // The methods are the HTTP methods to check
        http_methods = {
          criteria = "IS_IN"
          methods  = ["GET", "POST"]
        }
        // Path criteria
        // This criteria checks if the request path matches the specified criteria
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS"
        // The paths are the request paths to check
        // The paths can be a single path or a list of paths
        path = {
          criteria = "CONTAINS"
          paths    = ["/example"]
        }
        // Protocol criteria
        // This criteria checks if the request protocol matches the specified criteria
        protocol = "HTTPS"
        // Query criteria
        // This criteria checks if the query string matches the specified criteria
        query = [
          "example=example"
        ]
        // Request headers criteria
        // This criteria checks if the request headers match the specified criteria
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS" etc...
        // The name and values are the request header name and values to check
        request_headers = [
          {
            criteria = "CONTAINS"
            name     = "X-EXAMPLE"
            values   = ["example"]
          },
          {
            criteria = "BEGINS_WITH"
            name     = "X-CUSTOM"
            values   = ["example"]
          }
        ]
        // Response headers criteria
        // This criteria checks if the response headers match the specified criteria
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS" etc...
        // The name and values are the response header name and values to check
        // The response headers can be a single header or a list of headers
        response_headers = [
          {
            criteria = "CONTAINS"
            name     = "X-RESPONSE"
            values   = ["example"]
          },
          {
            criteria = "BEGINS_WITH"
            name     = "X-RESPONSE-CUSTOM"
            values   = ["example"]
          }
        ]
        // Service ports criteria
        // This criteria checks if the service port is in the specified list
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS" etc...
        // The ports are the service ports to check
        service_ports = {
          criteria = "IS_IN"
          ports    = ["80", "443"]
        }
        // Location criteria
        // This criteria checks if the request location matches the specified criteria
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS" etc...
        // The values are the request location to check
        location = {
          criteria = "IS_IN"
          values = [
            "example.com",
            "example.org"
          ]
        }
        // Status code criteria
        // This criteria checks if the response status code is in the specified list
        // The criteria can be "IS_IN", "IS_NOT_IN", "BEGINS_WITH", "ENDS_WITH", or "CONTAINS" etc...
        // The codes are the response status codes to check
        status_code = {
          criteria = "IS_IN"
          codes    = ["200", "301", "302"]
        }
      }

      // Define the action to take when the criteria is met
      actions = {
        redirect_to_https = 443
      }
    } // End policy 1
  ]   // End policies
}
```

## Import

Import is supported using the following syntax:
```shell
terraform import cloudavenue_elb_policies_http_security.example virtual_service_id
```

